const fn={articlesCollection:"https://atomicdata.dev/property/articles-collection",coverImage:"https://atomicdata.dev/Folder/wp8ame4nqf/urHO7G8FKm",pages:"https://atomicdata.dev/Folder/wp8ame4nqf/CE9kQa8EKz"};function Nt(){}function Ze(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}function Ke(n,...t){if(n==null)return Nt;const e=n.subscribe(...t);return e.unsubscribe?()=>e.unsubscribe():e}function Pt(n){let t;return Ke(n,e=>t=e)(),t}Promise.resolve();const lt=[];function Ce(n,t){return{subscribe:ke(n,t).subscribe}}function ke(n,t=Nt){let e;const i=new Set;function s(c){if(Ze(n,c)&&(n=c,e)){const l=!lt.length;for(const o of i)o[1](),lt.push(o,n);if(l){for(let o=0;o<lt.length;o+=2)lt[o][0](lt[o+1]);lt.length=0}}}function r(c){s(c(n))}function a(c,l=Nt){const o=[c,l];return i.add(o),i.size===1&&(e=t(s)||Nt),c(n),()=>{i.delete(o),i.size===0&&(e(),e=null)}}return{set:s,update:r,subscribe:a}}const Ie=ke(void 0),ie=Ce(void 0,n=>{Ie.subscribe(t=>{n(t)})}),hn=(n,t)=>{const e=Pt(ie);return Ce(e.getResourceLoading(n,t),i=>{i(e.getResourceLoading(n,t));const s=r=>{i(r)};return e.subscribe(n,s),()=>e.unsubscribe(n,s)})},dn=(n,t,e=!1)=>{const i=Pt(ie);let s=Pt(n);n.subscribe(f=>s=f);let r=s.get(t);const a=new Set;let c=!1;const l=f=>{r=f.get(t),o()},o=()=>{for(const f of a)f(r)},u=async f=>{r=f,f===void 0?s.removePropVal(t):s.set(t,f,i,!1),e&&await s.save(i),await i.notify(s)};return{set(f){u(f),o()},subscribe(f){return c||(i.subscribe(s.getSubject(),l),c=!0),a.add(f),f(r),()=>{a.delete(f),a.size===0&&(i.unsubscribe(s.getSubject(),l),c=!1)}},update(f){u(f(r)).then(()=>{o()})}}},Ye=n=>typeof n=="string"?[n]:Array.isArray(n)?n:[],pn=async(n,t)=>{const e=Pt(ie),i=async(r,a)=>{const c=[];for(const[l,o]of Object.entries(a)){await e.getResourceAsync(l);const u=Ye(r.get(l)),f=await Promise.all(u.map(b=>e.getResourceAsync(b)));if(typeof o!="boolean")for(const b of f)c.push(i(b,o))}return Promise.allSettled(c.flat())},s=await e.getResourceAsync(n);await i(s,t)},yn=n=>{Ie.set(n)};globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var se=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},oe=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};function Ne(n,t){return se(this,void 0,void 0,function(){var e,i,s,r,a;return oe(this,function(c){switch(c.label){case 0:if(e=he(),!t.subject)throw new Error("Agent has no subject, cannot authenticate");return a={"https://atomicdata.dev/properties/auth/agent":t.subject,"https://atomicdata.dev/properties/auth/requestedSubject":n},s="https://atomicdata.dev/properties/auth/publicKey",[4,t.getPublicKey()];case 1:return a[s]=c.sent(),a["https://atomicdata.dev/properties/auth/timestamp"]=e,r="https://atomicdata.dev/properties/auth/signature",[4,Pe(n,t,e)];case 2:return i=(a[r]=c.sent(),a),[2,i]}})})}function Pe(n,t,e){return se(this,void 0,void 0,function(){var i;return oe(this,function(s){switch(s.label){case 0:return i="".concat(n," ").concat(e),[4,We(i,t.privateKey)];case 1:return[2,s.sent()]}})})}function Xe(n,t){var e;return!n.startsWith("http://localhost")&&((e=t==null?void 0:t.subject)===null||e===void 0?void 0:e.startsWith("http://localhost"))}function pe(n,t,e){return se(this,void 0,void 0,function(){var i,s,r,a,c;return oe(this,function(l){switch(l.label){case 0:return i=he(),t!=null&&t.subject&&!Xe(n,t)?(s=e,r="x-atomic-public-key",[4,t.getPublicKey()]):[3,3];case 1:return s[r]=l.sent(),a=e,c="x-atomic-signature",[4,Pe(n,t,i)];case 2:a[c]=l.sent(),e["x-atomic-timestamp"]=i,e["x-atomic-agent"]=t==null?void 0:t.subject,l.label=3;case 3:return[2,e]}})})}var Qe=24*60*60*1e3,tr=function(n,t,e,i){i===void 0&&(i=Qe);var s=new Date(Date.now()+i).toUTCString(),r=encodeURIComponent(t),a=new URL(e).hostname,c="".concat(n,"=").concat(r,";Expires=").concat(s,";Domain=").concat(a,";SameSite=Lax;path=/");document.cookie=c},je=function(n,t){Ne(n,t).then(function(e){tr("atomic_session",btoa(JSON.stringify(e)),n)})},er=function(){var n=document.cookie.match(/^(.*;)?\s*atomic_session\s*=\s*[^;]+(.*)?$/);return n?n.length>0:!1};globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jt={},ir={get exports(){return jt},set exports(n){jt=n}};(function(n,t){var e=typeof self<"u"?self:rr,i=function(){function r(){this.fetch=!1,this.DOMException=e.DOMException}return r.prototype=e,new r}();(function(r){(function(a){var c={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function l(h){return h&&DataView.prototype.isPrototypeOf(h)}if(c.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(h){return h&&o.indexOf(Object.prototype.toString.call(h))>-1};function f(h){if(typeof h!="string"&&(h=String(h)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(h))throw new TypeError("Invalid character in header field name");return h.toLowerCase()}function b(h){return typeof h!="string"&&(h=String(h)),h}function m(h){var y={next:function(){var w=h.shift();return{done:w===void 0,value:w}}};return c.iterable&&(y[Symbol.iterator]=function(){return y}),y}function p(h){this.map={},h instanceof p?h.forEach(function(y,w){this.append(w,y)},this):Array.isArray(h)?h.forEach(function(y){this.append(y[0],y[1])},this):h&&Object.getOwnPropertyNames(h).forEach(function(y){this.append(y,h[y])},this)}p.prototype.append=function(h,y){h=f(h),y=b(y);var w=this.map[h];this.map[h]=w?w+", "+y:y},p.prototype.delete=function(h){delete this.map[f(h)]},p.prototype.get=function(h){return h=f(h),this.has(h)?this.map[h]:null},p.prototype.has=function(h){return this.map.hasOwnProperty(f(h))},p.prototype.set=function(h,y){this.map[f(h)]=b(y)},p.prototype.forEach=function(h,y){for(var w in this.map)this.map.hasOwnProperty(w)&&h.call(y,this.map[w],w,this)},p.prototype.keys=function(){var h=[];return this.forEach(function(y,w){h.push(w)}),m(h)},p.prototype.values=function(){var h=[];return this.forEach(function(y){h.push(y)}),m(h)},p.prototype.entries=function(){var h=[];return this.forEach(function(y,w){h.push([w,y])}),m(h)},c.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function v(h){if(h.bodyUsed)return Promise.reject(new TypeError("Already read"));h.bodyUsed=!0}function g(h){return new Promise(function(y,w){h.onload=function(){y(h.result)},h.onerror=function(){w(h.error)}})}function T(h){var y=new FileReader,w=g(y);return y.readAsArrayBuffer(h),w}function E(h){var y=new FileReader,w=g(y);return y.readAsText(h),w}function x(h){for(var y=new Uint8Array(h),w=new Array(y.length),j=0;j<y.length;j++)w[j]=String.fromCharCode(y[j]);return w.join("")}function U(h){if(h.slice)return h.slice(0);var y=new Uint8Array(h.byteLength);return y.set(new Uint8Array(h)),y.buffer}function I(){return this.bodyUsed=!1,this._initBody=function(h){this._bodyInit=h,h?typeof h=="string"?this._bodyText=h:c.blob&&Blob.prototype.isPrototypeOf(h)?this._bodyBlob=h:c.formData&&FormData.prototype.isPrototypeOf(h)?this._bodyFormData=h:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)?this._bodyText=h.toString():c.arrayBuffer&&c.blob&&l(h)?(this._bodyArrayBuffer=U(h.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(h)||u(h))?this._bodyArrayBuffer=U(h):this._bodyText=h=Object.prototype.toString.call(h):this._bodyText="",this.headers.get("content-type")||(typeof h=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var h=v(this);if(h)return h;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?v(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(T)}),this.text=function(){var h=v(this);if(h)return h;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(x(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(z)}),this.json=function(){return this.text().then(JSON.parse)},this}var J=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function bt(h){var y=h.toUpperCase();return J.indexOf(y)>-1?y:h}function N(h,y){y=y||{};var w=y.body;if(h instanceof N){if(h.bodyUsed)throw new TypeError("Already read");this.url=h.url,this.credentials=h.credentials,y.headers||(this.headers=new p(h.headers)),this.method=h.method,this.mode=h.mode,this.signal=h.signal,!w&&h._bodyInit!=null&&(w=h._bodyInit,h.bodyUsed=!0)}else this.url=String(h);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new p(y.headers)),this.method=bt(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function z(h){var y=new FormData;return h.trim().split("&").forEach(function(w){if(w){var j=w.split("="),P=j.shift().replace(/\+/g," "),R=j.join("=").replace(/\+/g," ");y.append(decodeURIComponent(P),decodeURIComponent(R))}}),y}function ct(h){var y=new p,w=h.replace(/\r?\n[\t ]+/g," ");return w.split(/\r?\n/).forEach(function(j){var P=j.split(":"),R=P.shift().trim();if(R){var _t=P.join(":").trim();y.append(R,_t)}}),y}I.call(N.prototype);function F(h,y){y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in y?y.statusText:"OK",this.headers=new p(y.headers),this.url=y.url||"",this._initBody(h)}I.call(F.prototype),F.prototype.clone=function(){return new F(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},F.error=function(){var h=new F(null,{status:0,statusText:""});return h.type="error",h};var ut=[301,302,303,307,308];F.redirect=function(h,y){if(ut.indexOf(y)===-1)throw new RangeError("Invalid status code");return new F(null,{status:y,headers:{location:h}})},a.DOMException=r.DOMException;try{new a.DOMException}catch{a.DOMException=function(y,w){this.message=y,this.name=w;var j=Error(y);this.stack=j.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function rt(h,y){return new Promise(function(w,j){var P=new N(h,y);if(P.signal&&P.signal.aborted)return j(new a.DOMException("Aborted","AbortError"));var R=new XMLHttpRequest;function _t(){R.abort()}R.onload=function(){var vt={status:R.status,statusText:R.statusText,headers:ct(R.getAllResponseHeaders()||"")};vt.url="responseURL"in R?R.responseURL:vt.headers.get("X-Request-URL");var zt="response"in R?R.response:R.responseText;w(new F(zt,vt))},R.onerror=function(){j(new TypeError("Network request failed"))},R.ontimeout=function(){j(new TypeError("Network request failed"))},R.onabort=function(){j(new a.DOMException("Aborted","AbortError"))},R.open(P.method,P.url,!0),P.credentials==="include"?R.withCredentials=!0:P.credentials==="omit"&&(R.withCredentials=!1),"responseType"in R&&c.blob&&(R.responseType="blob"),P.headers.forEach(function(vt,zt){R.setRequestHeader(zt,vt)}),P.signal&&(P.signal.addEventListener("abort",_t),R.onreadystatechange=function(){R.readyState===4&&P.signal.removeEventListener("abort",_t)}),R.send(typeof P._bodyInit>"u"?null:P._bodyInit)})}return rt.polyfill=!0,r.fetch||(r.fetch=rt,r.Headers=p,r.Request=N,r.Response=F),a.Headers=p,a.Request=N,a.Response=F,a.fetch=rt,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=i;t=s.fetch,t.default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,n.exports=t})(ir,jt);const sr=nr(jt);var te=globalThis&&globalThis.__assign||function(){return te=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},te.apply(this,arguments)},Rt=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},Tt=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},Wt=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},or=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},ar="application/ad+json",ot=function(){function n(t){this.__fetchOverride=t}return Object.defineProperty(n.prototype,"fetch",{get:function(){var t,e=(t=this.__fetchOverride)!==null&&t!==void 0?t:sr;if(typeof e>"u")throw new $("No fetch available, If the current environment doesn't have a fetch implementation you can pass one yourself.");return e},enumerable:!1,configurable:!0}),n.tryValidSubject=function(t){try{new URL(t)}catch(e){throw new Error("Not a valid URL: ".concat(t,". ").concat(e))}},n.isValidSubject=function(t){if(typeof t!="string")return!1;try{return n.tryValidSubject(t),!0}catch{return!1}},n.removeQueryParamsFromURL=function(t){return t==null?void 0:t.split("?")[0]},n.prototype.setFetch=function(t){this.__fetchOverride=t},n.prototype.fetchResourceHTTP=function(t,e){return e===void 0&&(e={}),Rt(this,void 0,void 0,function(){var i,s,r,a,c,l,o,u,f,b,m,p,v,g,T;return Tt(this,function(E){switch(E.label){case 0:i=e.signInfo,s=e.from,r=[],a=new At,c=new pt(t),E.label=1;case 1:return E.trys.push([1,7,,8]),n.tryValidSubject(t),l={},l.Accept=ar,i?t.startsWith(window.location.origin)?(er()||je(i.serverURL,i.agent),[3,4]):[3,2]:[3,4];case 2:return[4,pe(t,i.agent,l)];case 3:E.sent(),E.label=4;case 4:return o=t,s!==void 0&&(u=new URL("".concat(s,"/path")),u.searchParams.set("path",t),o=u.href),[4,this.fetch(o,{headers:l})];case 5:return f=E.sent(),[4,f.text()];case 6:if(b=E.sent(),f.status===200)try{m=JSON.parse(b),p=Wt(a.parseObject(m,t),2),v=p[0],g=p[1],c=v,r.push.apply(r,or([],Wt(g),!1))}catch(x){throw new $("Could not parse JSON from fetching ".concat(t,". Is it an Atomic Data resource? Error message: ").concat(x.message))}else throw f.status===401?new $(b,V.Unauthorized):f.status===500?new $(b,V.Server):f.status===404?new $(b,V.NotFound):new $(b);return[3,8];case 7:return T=E.sent(),c.setError(T),r=[c],console.error(t,T),[3,8];case 8:return c.loading=!1,[2,{resource:c,createdResources:r}]}})})},n.prototype.postCommit=function(t,e){return Rt(this,void 0,void 0,function(){var i,s,r,a,c;return Tt(this,function(l){switch(l.label){case 0:i=ze(te({},t)),s=new Headers,s.set("Content-Type","application/ad+json"),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.fetch(e,{headers:s,method:"POST",body:i})];case 2:return r=l.sent(),[3,4];case 3:throw a=l.sent(),new $("Posting Commit to ".concat(e," failed: ").concat(a));case 4:return[4,r.text()];case 5:if(c=l.sent(),r.status!==200)throw new $(c,V.Server);return[2,Ge(c)]}})})},n.prototype.uploadFiles=function(t,e,i,s){return Rt(this,void 0,void 0,function(){var r,a,c,l,o,u,f,b,m,p;return Tt(this,function(v){switch(v.label){case 0:return r=new At,a=new FormData,t.map(function(g){a.append("assets",g,g.name)}),c=new URL("".concat(e,"/upload")),c.searchParams.set("parent",s),[4,pe(c.toString(),i,{})];case 1:return l=v.sent(),o={method:"POST",body:a,headers:l},[4,this.fetch(c.toString(),o)];case 2:return u=v.sent(),[4,u.text()];case 3:if(f=v.sent(),u.status!==200)throw Error(f);return b=JSON.parse(f),m=Wt(r.parseArray(b),1),p=m[0],[2,p]}})})},n.prototype.importJsonAdUrl=function(t,e){return Rt(this,void 0,void 0,function(){var i;return Tt(this,function(s){return i=new URL(e),i.searchParams.set("url",t),[2,this.fetchResourceHTTP(i.toString())]})})},n}();const cr={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const k=BigInt(0),A=BigInt(1),D=BigInt(2),De=BigInt(255),ye=D**BigInt(252)+BigInt("27742317777372353535851937790883648493"),B={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:D**De-BigInt(19),l:ye,n:ye,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Fe=D**BigInt(256),St=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const ur=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),lr=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),fr=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),hr=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class _{constructor(t,e,i,s){this.x=t,this.y=e,this.z=i,this.t=s}static fromAffine(t){if(!(t instanceof C))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(C.ZERO)?_.ZERO:new _(t.x,t.y,A,d(t.x*t.y))}static toAffineBatch(t){const e=yr(t.map(i=>i.z));return t.map((i,s)=>i.toAffine(e[s]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){be(t);const{x:e,y:i,z:s}=this,{x:r,y:a,z:c}=t,l=d(e*c),o=d(r*s),u=d(i*c),f=d(a*s);return l===o&&u===f}negate(){return new _(d(-this.x),this.y,this.z,d(-this.t))}double(){const{x:t,y:e,z:i}=this,{a:s}=B,r=d(t**D),a=d(e**D),c=d(D*d(i**D)),l=d(s*r),o=d(d((t+e)**D)-r-a),u=l+a,f=u-c,b=l-a,m=d(o*f),p=d(u*b),v=d(o*b),g=d(f*u);return new _(m,p,g,v)}add(t){be(t);const{x:e,y:i,z:s,t:r}=this,{x:a,y:c,z:l,t:o}=t,u=d((i-e)*(c+a)),f=d((i+e)*(c-a)),b=d(f-u);if(b===k)return this.double();const m=d(s*D*o),p=d(r*D*l),v=p+m,g=f+u,T=p-m,E=d(v*b),x=d(g*T),U=d(v*T),I=d(b*g);return new _(E,x,I,U)}subtract(t){return this.add(t.negate())}precomputeWindow(t){const e=1+256/t,i=[];let s=this,r=s;for(let a=0;a<e;a++){r=s,i.push(r);for(let c=1;c<2**(t-1);c++)r=r.add(s),i.push(r);s=r.double()}return i}wNAF(t,e){!e&&this.equals(_.BASE)&&(e=C.BASE);const i=e&&e._WINDOW_SIZE||1;if(256%i)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=e&&ee.get(e);s||(s=this.precomputeWindow(i),e&&i!==1&&(s=_.normalizeZ(s),ee.set(e,s)));let r=_.ZERO,a=_.ZERO;const c=1+256/i,l=2**(i-1),o=BigInt(2**i-1),u=2**i,f=BigInt(i);for(let b=0;b<c;b++){const m=b*l;let p=Number(t&o);if(t>>=f,p>l&&(p-=u,t+=A),p===0){let v=s[m];b%2&&(v=v.negate()),a=a.add(v)}else{let v=s[m+Math.abs(p)-1];p<0&&(v=v.negate()),r=r.add(v)}}return _.normalizeZ([r,a])[0]}multiply(t,e){return this.wNAF(Dt(t,B.l),e)}multiplyUnsafe(t){let e=Dt(t,B.l,!1);const i=_.BASE,s=_.ZERO;if(e===k)return s;if(this.equals(s)||e===A)return this;if(this.equals(i))return this.wNAF(e);let r=s,a=this;for(;e>k;)e&A&&(r=r.add(a)),a=a.double(),e>>=A;return r}isSmallOrder(){return this.multiplyUnsafe(B.h).equals(_.ZERO)}isTorsionFree(){return this.multiplyUnsafe(B.l).equals(_.ZERO)}toAffine(t=Lt(this.z)){const{x:e,y:i,z:s}=this,r=d(e*t),a=d(i*t);if(d(s*t)!==A)throw new Error("invZ was invalid");return new C(r,a)}fromRistrettoBytes(){Vt()}toRistrettoBytes(){Vt()}fromRistrettoHash(){Vt()}}_.BASE=new _(B.Gx,B.Gy,A,d(B.Gx*B.Gy));_.ZERO=new _(k,A,A,k);function be(n){if(!(n instanceof _))throw new TypeError("ExtendedPoint expected")}function Gt(n){if(!(n instanceof H))throw new TypeError("RistrettoPoint expected")}function Vt(){throw new Error("Legacy method: switch to RistrettoPoint")}class H{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){const{d:e}=B,i=d(St*t*t),s=d((i+A)*fr);let r=BigInt(-1);const a=d((r-e*i)*d(i+e));let{isValid:c,value:l}=ce(s,a),o=d(l*t);tt(o)||(o=d(-o)),c||(l=o),c||(r=i);const u=d(r*(i-A)*hr-a),f=l*l,b=d((l+l)*a),m=d(u*ur),p=d(A-f),v=d(A+f);return new _(d(b*v),d(p*m),d(m*v),d(b*p))}static hashToCurve(t){t=at(t,64);const e=qt(t.slice(0,32)),i=this.calcElligatorRistrettoMap(e),s=qt(t.slice(32,64)),r=this.calcElligatorRistrettoMap(s);return new H(i.add(r))}static fromHex(t){t=at(t,32);const{a:e,d:i}=B,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",r=qt(t);if(!vr(xt(r),t)||tt(r))throw new Error(s);const a=d(r*r),c=d(A+e*a),l=d(A-e*a),o=d(c*c),u=d(l*l),f=d(e*i*o-u),{isValid:b,value:m}=ve(d(f*u)),p=d(m*l),v=d(m*p*f);let g=d((r+r)*p);tt(g)&&(g=d(-g));const T=d(c*v),E=d(g*T);if(!b||tt(E)||T===k)throw new Error(s);return new H(new _(g,T,A,E))}toRawBytes(){let{x:t,y:e,z:i,t:s}=this.ep;const r=d(d(i+e)*d(i-e)),a=d(t*e),{value:c}=ve(d(r*a**D)),l=d(c*r),o=d(c*a),u=d(l*o*s);let f;if(tt(s*u)){let m=d(e*St),p=d(t*St);t=m,e=p,f=d(l*lr)}else f=o;tt(t*u)&&(e=d(-e));let b=d((i-e)*f);return tt(b)&&(b=d(-b)),xt(b)}toHex(){return Et(this.toRawBytes())}toString(){return this.toHex()}equals(t){Gt(t);const e=this.ep,i=t.ep,s=d(e.x*i.y)===d(e.y*i.x),r=d(e.y*i.y)===d(e.x*i.x);return s||r}add(t){return Gt(t),new H(this.ep.add(t.ep))}subtract(t){return Gt(t),new H(this.ep.subtract(t.ep))}multiply(t){return new H(this.ep.multiply(t))}multiplyUnsafe(t){return new H(this.ep.multiplyUnsafe(t))}}H.BASE=new H(_.BASE);H.ZERO=new H(_.ZERO);const ee=new WeakMap;class C{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,ee.delete(this)}static fromHex(t,e=!0){const{d:i,P:s}=B;t=at(t,32);const r=t.slice();r[31]=t[31]&-129;const a=yt(r);if(e&&a>=s)throw new Error("Expected 0 < hex < P");if(!e&&a>=Fe)throw new Error("Expected 0 < hex < 2**256");const c=d(a*a),l=d(c-A),o=d(i*c+A);let{isValid:u,value:f}=ce(l,o);if(!u)throw new Error("Point.fromHex: invalid y coordinate");const b=(f&A)===A;return(t[31]&128)!==0!==b&&(f=d(-f)),new C(f,a)}static async fromPrivateKey(t){return(await ue(t)).point}toRawBytes(){const t=xt(this.y);return t[31]|=this.x&A?128:0,t}toHex(){return Et(this.toRawBytes())}toX25519(){const{y:t}=this,e=d((A+t)*Lt(A-t));return xt(e)}isTorsionFree(){return _.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new C(d(-this.x),this.y)}add(t){return _.fromAffine(this).add(_.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return _.fromAffine(this).multiply(t,this).toAffine()}}C.BASE=new C(B.Gx,B.Gy);C.ZERO=new C(k,A);class ae{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=at(t,64),i=C.fromHex(e.slice(0,32),!1),s=yt(e.slice(32,64));return new ae(i,s)}assertValidity(){const{r:t,s:e}=this;if(!(t instanceof C))throw new Error("Expected Point instance");return Dt(e,B.l,!1),this}toRawBytes(){const t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(xt(this.s),32),t}toHex(){return Et(this.toRawBytes())}}function dr(...n){if(!n.every(i=>i instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(n.length===1)return n[0];const t=n.reduce((i,s)=>i+s.length,0),e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}const pr=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function Et(n){if(!(n instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let e=0;e<n.length;e++)t+=pr[n[e]];return t}function Le(n){if(typeof n!="string")throw new TypeError("hexToBytes: expected string, got "+typeof n);if(n.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(n.length/2);for(let e=0;e<t.length;e++){const i=e*2,s=n.slice(i,i+2),r=Number.parseInt(s,16);if(Number.isNaN(r)||r<0)throw new Error("Invalid byte sequence");t[e]=r}return t}function Me(n){const e=n.toString(16).padStart(64,"0");return Le(e)}function xt(n){return Me(n).reverse()}function tt(n){return(d(n)&A)===A}function yt(n){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Et(Uint8Array.from(n).reverse()))}function qt(n){return d(yt(n)&D**De-A)}function d(n,t=B.P){const e=n%t;return e>=k?e:t+e}function Lt(n,t=B.P){if(n===k||t<=k)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=d(n,t),i=t,s=k,r=A;for(;e!==k;){const c=i/e,l=i%e,o=s-r*c;i=e,e=l,s=r,r=o}if(i!==A)throw new Error("invert: does not exist");return d(s,t)}function yr(n,t=B.P){const e=new Array(n.length),i=n.reduce((r,a,c)=>a===k?r:(e[c]=r,d(r*a,t)),A),s=Lt(i,t);return n.reduceRight((r,a,c)=>a===k?r:(e[c]=d(r*e[c],t),d(r*a,t)),s),e}function q(n,t){const{P:e}=B;let i=n;for(;t-- >k;)i*=i,i%=e;return i}function br(n){const{P:t}=B,e=BigInt(5),i=BigInt(10),s=BigInt(20),r=BigInt(40),a=BigInt(80),l=n*n%t*n%t,o=q(l,D)*l%t,u=q(o,A)*n%t,f=q(u,e)*u%t,b=q(f,i)*f%t,m=q(b,s)*b%t,p=q(m,r)*m%t,v=q(p,a)*p%t,g=q(v,a)*p%t,T=q(g,i)*f%t;return{pow_p_5_8:q(T,D)*n%t,b2:l}}function ce(n,t){const e=d(t*t*t),i=d(e*e*t),s=br(n*i).pow_p_5_8;let r=d(n*e*s);const a=d(t*r*r),c=r,l=d(r*St),o=a===n,u=a===d(-n),f=a===d(-n*St);return o&&(r=c),(u||f)&&(r=l),tt(r)&&(r=d(-r)),{isValid:o||u,value:r}}function ve(n){return ce(A,n)}async function me(...n){const t=await Mt.sha512(dr(...n)),e=yt(t);return d(e,B.l)}function vr(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function at(n,t){const e=n instanceof Uint8Array?Uint8Array.from(n):Le(n);if(typeof t=="number"&&e.length!==t)throw new Error(`Expected ${t} bytes`);return e}function Dt(n,t,e=!0){if(!t)throw new TypeError("Specify max value");if(typeof n=="number"&&Number.isSafeInteger(n)&&(n=BigInt(n)),typeof n=="bigint"&&n<t){if(e){if(k<n)return n}else if(k<=n)return n}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function mr(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}async function ue(n){if(n=typeof n=="bigint"||typeof n=="number"?Me(Dt(n,Fe)):at(n),n.length!==32)throw new Error("Expected 32 bytes");const t=await Mt.sha512(n),e=mr(t.slice(0,32)),i=t.slice(32,64),s=d(yt(e),B.l),r=C.BASE.multiply(s),a=r.toRawBytes();return{head:e,prefix:i,scalar:s,point:r,pointBytes:a}}async function gr(n,t){n=at(n);const{prefix:e,scalar:i,pointBytes:s}=await ue(t),r=await me(e,n),a=C.BASE.multiply(r),c=await me(a.toRawBytes(),s,n),l=d(r+c*i,B.l);return new ae(a,l).toRawBytes()}C.BASE._setWindowSize(8);const Y={node:cr,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Mt={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Et,getExtendedPublicKey:ue,mod:d,invert:Lt,hashToPrivateScalar:n=>{if(n=at(n),n.length<40||n.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const t=d(yt(n),B.l);if(t===k||t===A)throw new Error("Invalid private key");return t},randomBytes:(n=32)=>{if(Y.web)return Y.web.getRandomValues(new Uint8Array(n));if(Y.node){const{randomBytes:t}=Y.node;return new Uint8Array(t(n).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Mt.randomBytes(32),sha512:async n=>{if(Y.web){const t=await Y.web.subtle.digest("SHA-512",n.buffer);return new Uint8Array(t)}else{if(Y.node)return Uint8Array.from(Y.node.createHash("sha512").update(n).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(n=8,t=C.BASE){const e=t.equals(C.BASE)?t:new C(t.x,t.y);return e._setWindowSize(n),e.multiply(D),e}};var wr=function(n,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(r){return function(a){return function(c,l){var o={key:c,value:a[c]},u={key:l,value:a[l]};return r(o,u)}}}(t.cmp),s=[];return function r(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var c,l;if(Array.isArray(a)){for(l="[",c=0;c<a.length;c++)c&&(l+=","),l+=r(a[c])||"null";return l+"]"}if(a===null)return"null";if(s.indexOf(a)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=s.push(a)-1,u=Object.keys(a).sort(i&&i(a));for(l="",c=0;c<u.length;c++){var f=u[c],b=r(a[f]);b&&(l&&(l+=","),l+=JSON.stringify(f)+":"+b)}return s.splice(o,1),"{"+l+"}"}}(n)};const Sr=wr;var dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Bt=0;Bt<dt.length;Bt++)wt[dt.charCodeAt(Bt)]=Bt;var xr=function(n){var t=new Uint8Array(n),e,i=t.length,s="";for(e=0;e<i;e+=3)s+=dt[t[e]>>2],s+=dt[(t[e]&3)<<4|t[e+1]>>4],s+=dt[(t[e+1]&15)<<2|t[e+2]>>6],s+=dt[t[e+2]&63];return i%3===2?s=s.substring(0,s.length-1)+"=":i%3===1&&(s=s.substring(0,s.length-2)+"=="),s},Ar=function(n){var t=n.length*.75,e=n.length,i,s=0,r,a,c,l;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var o=new ArrayBuffer(t),u=new Uint8Array(o);for(i=0;i<e;i+=4)r=wt[n.charCodeAt(i)],a=wt[n.charCodeAt(i+1)],c=wt[n.charCodeAt(i+2)],l=wt[n.charCodeAt(i+3)],u[s++]=r<<2|a>>4,u[s++]=(a&15)<<4|c>>2,u[s++]=(c&3)<<6|l&63;return o};/*! noble-hashes - MIT License (c) 2021 Paul Miller (paulmillr.com) */const $t=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),Er=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Er)throw new Error("Non little-endian hardware is not supported");Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));(()=>{const n=typeof module<"u"&&typeof module.require=="function"&&module.require.bind(module);try{if(n){const{setImmediate:t}=n("timers");return()=>new Promise(e=>t(e))}}catch{}return()=>new Promise(t=>setTimeout(t,0))})();function _r(n){if(typeof n!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof n}`);return new TextEncoder().encode(n)}function He(n){if(typeof n=="string"&&(n=_r(n)),!(n instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof n})`);return n}class Rr{clone(){return this._cloneInto()}}function le(n){const t=i=>n().update(He(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t.init=t.create,t}function Tr(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const s=BigInt(32),r=BigInt(4294967295),a=Number(e>>s&r),c=Number(e&r),l=i?4:0,o=i?0:4;n.setUint32(t+l,a,i),n.setUint32(t+o,c,i)}class Br extends Rr{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=$t(this.buffer)}update(t){if(this.destroyed)throw new Error("instance is destroyed");const{view:e,buffer:i,blockLen:s,finished:r}=this;if(r)throw new Error("digest() was already called");t=He(t);const a=t.length;for(let c=0;c<a;){const l=Math.min(s-this.pos,a-c);if(l===s){const o=$t(t);for(;s<=a-c;c+=s)this.process(o,c);continue}i.set(t.subarray(c,c+l),this.pos),this.pos+=l,c+=l,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){if(this.destroyed)throw new Error("instance is destroyed");if(!(t instanceof Uint8Array)||t.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)e[l]=0;Tr(i,s-8,BigInt(this.length*8),r),this.process(i,0);const c=$t(t);this.get().forEach((l,o)=>c.setUint32(4*o,l,r))}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:a,pos:c}=this;return t.length=s,t.pos=c,t.finished=r,t.destroyed=a,s%e&&t.buffer.set(i),t}}const Ut=BigInt(2**32-1),ge=BigInt(32);function Ur(n,t=!1){return t?{h:Number(n&Ut),l:Number(n>>ge&Ut)}:{h:Number(n>>ge&Ut)|0,l:Number(n&Ut)|0}}function Or(n,t=!1){let e=new Uint32Array(n.length),i=new Uint32Array(n.length);for(let s=0;s<n.length;s++){const{h:r,l:a}=Ur(n[s],t);[e[s],i[s]]=[r,a]}return[e,i]}const we=(n,t,e)=>n>>>e,Se=(n,t,e)=>n<<32-e|t>>>e,ft=(n,t,e)=>n>>>e|t<<32-e,ht=(n,t,e)=>n<<32-e|t>>>e,Ot=(n,t,e)=>n<<64-e|t>>>e-32,Ct=(n,t,e)=>n>>>e-32|t<<64-e;function Z(n,t,e,i){const s=(t>>>0)+(i>>>0);return{h:n+e+(s/2**32|0)|0,l:s|0}}const Cr=(n,t,e)=>(n>>>0)+(t>>>0)+(e>>>0),kr=(n,t,e,i)=>t+e+i+(n/2**32|0)|0,Ir=(n,t,e,i)=>(n>>>0)+(t>>>0)+(e>>>0)+(i>>>0),Nr=(n,t,e,i,s)=>t+e+i+s+(n/2**32|0)|0,Pr=(n,t,e,i,s)=>(n>>>0)+(t>>>0)+(e>>>0)+(i>>>0)+(s>>>0),jr=(n,t,e,i,s,r)=>t+e+i+s+r+(n/2**32|0)|0,[Dr,Fr]=Or(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),X=new Uint32Array(80),Q=new Uint32Array(80);class fe extends Br{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:i,Bl:s,Ch:r,Cl:a,Dh:c,Dl:l,Eh:o,El:u,Fh:f,Fl:b,Gh:m,Gl:p,Hh:v,Hl:g}=this;return[t,e,i,s,r,a,c,l,o,u,f,b,m,p,v,g]}set(t,e,i,s,r,a,c,l,o,u,f,b,m,p,v,g){this.Ah=t|0,this.Al=e|0,this.Bh=i|0,this.Bl=s|0,this.Ch=r|0,this.Cl=a|0,this.Dh=c|0,this.Dl=l|0,this.Eh=o|0,this.El=u|0,this.Fh=f|0,this.Fl=b|0,this.Gh=m|0,this.Gl=p|0,this.Hh=v|0,this.Hl=g|0}process(t,e){for(let x=0;x<16;x++,e+=4)X[x]=t.getUint32(e),Q[x]=t.getUint32(e+=4);for(let x=16;x<80;x++){const U=X[x-15]|0,I=Q[x-15]|0,J=ft(U,I,1)^ft(U,I,8)^we(U,I,7),bt=ht(U,I,1)^ht(U,I,8)^Se(U,I,7),N=X[x-2]|0,z=Q[x-2]|0,ct=ft(N,z,19)^Ot(N,z,61)^we(N,z,6),F=ht(N,z,19)^Ct(N,z,61)^Se(N,z,6),ut=Ir(bt,F,Q[x-7],Q[x-16]),rt=Nr(ut,J,ct,X[x-7],X[x-16]);X[x]=rt|0,Q[x]=ut|0}let{Ah:i,Al:s,Bh:r,Bl:a,Ch:c,Cl:l,Dh:o,Dl:u,Eh:f,El:b,Fh:m,Fl:p,Gh:v,Gl:g,Hh:T,Hl:E}=this;for(let x=0;x<80;x++){const U=ft(f,b,14)^ft(f,b,18)^Ot(f,b,41),I=ht(f,b,14)^ht(f,b,18)^Ct(f,b,41),J=f&m^~f&v,bt=b&p^~b&g,N=Pr(E,I,bt,Fr[x],Q[x]),z=jr(N,T,U,J,Dr[x],X[x]),ct=N|0,F=ft(i,s,28)^Ot(i,s,34)^Ot(i,s,39),ut=ht(i,s,28)^Ct(i,s,34)^Ct(i,s,39),rt=i&r^i&c^r&c,h=s&a^s&l^a&l;T=v|0,E=g|0,v=m|0,g=p|0,m=f|0,p=b|0,{h:f,l:b}=Z(o|0,u|0,z|0,ct|0),o=c|0,u=l|0,c=r|0,l=a|0,r=i|0,a=s|0;const y=Cr(ct,ut,h);i=kr(y,z,F,rt),s=y|0}({h:i,l:s}=Z(this.Ah|0,this.Al|0,i|0,s|0)),{h:r,l:a}=Z(this.Bh|0,this.Bl|0,r|0,a|0),{h:c,l}=Z(this.Ch|0,this.Cl|0,c|0,l|0),{h:o,l:u}=Z(this.Dh|0,this.Dl|0,o|0,u|0),{h:f,l:b}=Z(this.Eh|0,this.El|0,f|0,b|0),{h:m,l:p}=Z(this.Fh|0,this.Fl|0,m|0,p|0),{h:v,l:g}=Z(this.Gh|0,this.Gl|0,v|0,g|0),{h:T,l:E}=Z(this.Hh|0,this.Hl|0,T|0,E|0),this.set(i,s,r,a,c,l,o,u,f,b,m,p,v,g,T,E)}roundClean(){X.fill(0),Q.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Lr extends fe{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Mr extends fe{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}const Hr=le(()=>new fe);le(()=>new Lr);le(()=>new Mr);var nt=globalThis&&globalThis.__assign||function(){return nt=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},nt.apply(this,arguments)},re=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},ne=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},Ht=globalThis&&globalThis.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},M=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},st=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))};Mt.sha512=function(n){return Promise.resolve(Hr(n))};function he(){return Math.round(new Date().getTime())}var Jt=function(){function n(t,e){e===void 0&&(e={});var i,s,r;this._subject=ot.removeQueryParamsFromURL(t),this._set=(i=e.set)!==null&&i!==void 0?i:new Map,this._push=(s=e.push)!==null&&s!==void 0?s:new Map,this._remove=(r=e.remove)!==null&&r!==void 0?r:new Set,this._destroy=e.destroy,this._previousCommit=e.previousCommit}return Object.defineProperty(n.prototype,"subject",{get:function(){return this._subject},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"set",{get:function(){return this._set},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"push",{get:function(){return this._push},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remove",{get:function(){return this._remove},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"destroy",{get:function(){return this._destroy},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"previousCommit",{get:function(){return this._previousCommit},enumerable:!1,configurable:!0}),n.prototype.addSetAction=function(t,e){return this.removeRemoveAction(t),this._set.set(t,e),this},n.prototype.addPushAction=function(t){for(var e,i,s,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var c=(s=this._push.get(t))!==null&&s!==void 0?s:new Set;try{for(var l=Ht(r),o=l.next();!o.done;o=l.next()){var u=o.value;c.add(u)}}catch(f){e={error:f}}finally{try{o&&!o.done&&(i=l.return)&&i.call(l)}finally{if(e)throw e.error}}return this._push.set(t,c),this},n.prototype.addRemoveAction=function(t){return this._set.delete(t),this._push.delete(t),this._remove.add(t),this},n.prototype.removeRemoveAction=function(t){return this._remove.delete(t),this},n.prototype.setDestroy=function(t){return this._destroy=t,this},n.prototype.setPreviousCommit=function(t){return this._previousCommit=t,this},n.prototype.setSubject=function(t){return this._subject=t,this},n.prototype.sign=function(t,e){return re(this,void 0,void 0,function(){var i;return ne(this,function(s){switch(s.label){case 0:return[4,this.signAt(e,t,he())];case 1:return i=s.sent(),[2,i]}})})},n.prototype.hasUnsavedChanges=function(){return this.set.size>0||this.push.size>0||this.destroy||this.remove.size>0},n.prototype.clone=function(){var t={set:this.set,push:this.push,remove:this.remove,destroy:this.destroy,previousCommit:this.previousCommit};return new n(this.subject,structuredClone(t))},n.prototype.toPlainObject=function(){return{subject:this.subject,set:Object.fromEntries(this.set.entries()),push:Object.fromEntries(Array.from(this.push.entries()).map(function(t){var e=M(t,2),i=e[0],s=e[1];return[i,Array.from(s)]})),remove:Array.from(this.remove),destroy:this.destroy,previousCommit:this.previousCommit}},n.prototype.signAt=function(t,e,i){return re(this,void 0,void 0,function(){var s,r,a,c;return ne(this,function(l){switch(l.label){case 0:if(t===void 0)throw new Error("No agent passed to sign commit");return s=nt(nt({},this.clone().toPlainObject()),{createdAt:i,signer:t}),r=ze(nt({},s)),[4,We(r,e)];case 1:return a=l.sent(),c=nt(nt({},s),{signature:a}),[2,c]}})})},n}();function K(n,t,e){t in n&&t!==e&&(Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(n,t)),delete n[t])}function ze(n){return n.remove&&Object.keys(n.remove).length===0&&delete n.remove,n.set&&Object.keys(n.set).length===0&&delete n.set,n.push&&Object.keys(n.push).length===0&&delete n.push,n.destroy===!1&&delete n.destroy,K(n,"createdAt",S.properties.commit.createdAt),K(n,"subject",S.properties.commit.subject),K(n,"set",S.properties.commit.set),K(n,"push",S.properties.commit.push),K(n,"signer",S.properties.commit.signer),K(n,"signature",S.properties.commit.signature),K(n,"remove",S.properties.commit.remove),K(n,"destroy",S.properties.commit.destroy),K(n,"previousCommit",S.properties.commit.previousCommit),n[S.properties.isA]=[S.classes.commit],Sr(n)}var We=function(n,t){return re(void 0,void 0,void 0,function(){var e,i,s,r,a,c;return ne(this,function(l){switch(l.label){case 0:return e=Ar(t),i=new Uint8Array(e),s=new TextEncoder,r=s.encode(n),[4,gr(r,i)];case 1:return a=l.sent(),c=xr(a),[2,c]}})})};function Ge(n){try{var t=JSON.parse(n),e=t[S.properties.commit.subject],i=t[S.properties.commit.set],s=t[S.properties.commit.push],r=t[S.properties.commit.signer],a=t[S.properties.commit.createdAt],c=t[S.properties.commit.remove],l=t[S.properties.commit.destroy],o=t[S.properties.commit.signature],u=t["@id"],f=t[S.properties.commit.previousCommit];return{subject:e,set:i,push:s,signer:r,createdAt:a,remove:c,destroy:l,signature:o,id:u,previousCommit:f}}catch(b){throw new Error("Could not parse commit: ".concat(b))}}function zr(n,t){var e=Ge(n),i=e.subject,s=e.set,r=e.remove,a=e.id,c=e.destroy,l=e.signature,o=e.push,u=t.resources.get(i);if(!u)u=new pt(i);else if(u.appliedCommitSignatures.has(l))return;if(s&&Wr(s,u,t),r&&Gr(r,u),o&&Vr(o,u,t),a&&u.setUnsafe(L.commit.lastCommit,a),c){t.removeResource(i);return}else u.appliedCommitSignatures.add(l),t.addResources(u)}function Wr(n,t,e){var i,s,r=new At,a=[],c=function(m,p){var v=p;if((p==null?void 0:p.constructor)==={}.constructor){var g=M(r.parseValue(p,m),2),T=g[0],E=g[1];v=T,a.push.apply(a,st([],M(E),!1))}de(p)&&(v=p.map(function(x){var U=M(r.parseValue(x,m),2),I=U[0],J=U[1];return a.push.apply(a,st([],M(J),!1)),I})),t.setUnsafe(m,v)};try{for(var l=Ht(Object.entries(n)),o=l.next();!o.done;o=l.next()){var u=M(o.value,2),f=u[0],b=u[1];c(f,b)}}catch(m){i={error:m}}finally{try{o&&!o.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}e.addResources.apply(e,st([],M(a),!1))}function Gr(n,t){var e,i;try{for(var s=Ht(n),r=s.next();!r.done;r=s.next()){var a=r.value;t.removePropValLocally(a)}}catch(c){e={error:c}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}}function Vr(n,t,e){var i,s,r=new At,a=[],c=function(m,p){var v=t.get(m)||[],g=p,T=g.map(function(x){var U=M(r.parseValue(x,m),2),I=U[0],J=U[1];return a.push.apply(a,st([],M(J),!1)),I}),E=st(st([],M(v),!1),M(T),!1);t.setUnsafe(m,E)};try{for(var l=Ht(Object.entries(n)),o=l.next();!o.done;o=l.next()){var u=M(o.value,2),f=u[0],b=u[1];c(f,b)}}catch(m){i={error:m}}finally{try{o&&!o.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}e.addResources.apply(e,st([],M(a),!1))}var qr=globalThis&&globalThis.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),V;(function(n){n.Unauthorized="Unauthorized",n.NotFound="NotFound",n.Server="Server",n.Client="Client"})(V||(V={}));function $r(n){if(n instanceof $){if(n.type===V.Unauthorized)return!0;if(n.message.includes("Unauthorized"))return!0}return!1}var $=function(n){qr(t,n);function t(e,i){i===void 0&&(i=V.Client);var s=n.call(this,e)||this;Object.setPrototypeOf(s,t.prototype),s.type=i,s.message=e;try{var r=JSON.parse(e),a=r[L.description];a&&(s.message=a)}catch{}return s.message||(s.message=s.createMessage()),s}return t.fromResource=function(e){var i=new t(e.get(L.description).toString());return i},t.prototype.createMessage=function(){switch(this.type){case V.Unauthorized:return"You don't have the rights to do this.";case V.NotFound:return"404 Not found.";case V.Server:return"500 Unknown server error.";default:return"Unknown error."}},t}(Error),O;(function(n){n.ATOMIC_URL="https://atomicdata.dev/datatypes/atomicURL",n.BOOLEAN="https://atomicdata.dev/datatypes/boolean",n.DATE="https://atomicdata.dev/datatypes/date",n.FLOAT="https://atomicdata.dev/datatypes/float",n.INTEGER="https://atomicdata.dev/datatypes/integer",n.MARKDOWN="https://atomicdata.dev/datatypes/markdown",n.RESOURCEARRAY="https://atomicdata.dev/datatypes/resourceArray",n.SLUG="https://atomicdata.dev/datatypes/slug",n.STRING="https://atomicdata.dev/datatypes/string",n.TIMESTAMP="https://atomicdata.dev/datatypes/timestamp",n.UNKNOWN="unknown-datatype"})(O||(O={}));var Jr=function(n){switch(n){case S.datatypes.atomicUrl:return O.ATOMIC_URL;case S.datatypes.boolean:return O.BOOLEAN;case S.datatypes.date:return O.DATE;case S.datatypes.float:return O.FLOAT;case S.datatypes.integer:return O.INTEGER;case S.datatypes.markdown:return O.MARKDOWN;case S.datatypes.resourceArray:return O.RESOURCEARRAY;case S.datatypes.slug:return O.SLUG;case S.datatypes.string:return O.STRING;case S.datatypes.timestamp:return O.TIMESTAMP;default:return O.UNKNOWN}},Zr=/^[a-z0-9]+(?:-[a-z0-9]+)*$/,Kr=/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,Yr=function(n,t){var e=null;if(n===void 0)throw new Error("Value is undefined, expected ".concat(t));switch(t){case O.STRING:{if(!kt(n)){e="Not a string";break}break}case O.SLUG:{if(!kt(n)){e="Not a slug, not even a string";break}n.match(Zr)===null&&(e="Not a valid slug. Only lowercase letters and numbers with dashes `-` between them");break}case O.ATOMIC_URL:{if(!kt(n)){e="Not a string. Should be a URL";break}ot.tryValidSubject(n);break}case O.RESOURCEARRAY:{if(!de(n)){e="Not an array";break}n.map(function(i,s){try{ot.tryValidSubject(i)}catch{var r=new Error("Invalid URL");throw r.index=s,r}});break}case O.INTEGER:{if(!Xr(n)){e="Not a number";break}n%1!==0&&(e="Not an integer");break}case O.DATE:{if(!kt(n)){e="Not a string";break}n.match(Kr)===null&&(e="Not a date string: YYYY-MM-DD");break}}if(e!==null)throw new Error(e)};function de(n){return Object.prototype.toString.call(n)==="[object Array]"}function kt(n){return typeof n=="string"}function Xr(n){return typeof n=="number"}var It=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},Zt=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},xe=globalThis&&globalThis.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},At=function(){function n(){this.parsedResources=[]}return n.prototype.parseObject=function(t,e){this.parsedResources=[];var i=this.parseJsonADResource(t,e);return[i,Zt([],It(this.parsedResources),!1)]},n.prototype.parseArray=function(t){this.parsedResources=[];var e=this.parseJsonADArray(t);return[e,Zt([],It(this.parsedResources),!1)]},n.prototype.parseValue=function(t,e){this.parsedResources=[];var i=this.parseJsonAdResourceValue(t,e);return[i,Zt([],It(this.parsedResources),!1)]},n.prototype.parseJsonADResource=function(t,e){var i,s,r=this;e===void 0&&(e=it);var a=new pt(e);this.parsedResources.push(a);try{var c=function(p,v){if(p==="@id"){if(typeof v!="string")throw new Error("'@id' field must be a string");if(a.getSubject()!=="undefined"&&a.getSubject()!==it&&v!==a.getSubject())throw new Error("Resource has wrong subject in @id. Received subject was ".concat(v,", expected ").concat(a.getSubject(),"."));return a.setSubject(v),"continue"}try{if(de(v)){var g=v.map(function(U){return r.parseJsonAdResourceValue(U,p)});a.setUnsafe(p,g)}else if(typeof v=="string")a.setUnsafe(p,v);else if(typeof v=="number")a.setUnsafe(p,v);else if(typeof v=="boolean")a.setUnsafe(p,v);else{var T=l.parseJsonAdResourceValue(v,p);a.setUnsafe(p,T)}}catch(U){var E="Failed creating value ".concat(v," for key ").concat(p," in resource ").concat(a.getSubject()),x="".concat(E,". ").concat(U.message);throw new Error(x)}},l=this;try{for(var o=xe(Object.entries(t)),u=o.next();!u.done;u=o.next()){var f=It(u.value,2),b=f[0],m=f[1];c(b,m)}}catch(p){i={error:p}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}a.loading=!1,a.hasClasses(S.classes.error)&&(a.error=$.fromResource(a))}catch(p){throw p.message="Failed parsing JSON "+p.message,a.setError(p),a.loading=!1,p}return a},n.prototype.parseJsonAdResourceValue=function(t,e){if(typeof t=="string")return t;if((t==null?void 0:t.constructor)==={}.constructor)if(Object.keys(t).includes("@id")){var i=t["@id"];return this.parseJsonADResource(t),i}else return t;throw new Error("Value ".concat(t," in ").concat(e," not a string or a nested Resource"))},n.prototype.parseJsonADArray=function(t){var e,i,s=[];try{try{for(var r=xe(t),a=r.next();!a.done;a=r.next()){var c=a.value,l=this.parseJsonADResource(c);s.push(l)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}catch(o){throw o.message="Failed parsing JSON "+o.message,o}return s},n}(),mt=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},gt=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},Kt=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},Yt=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},it="unknown-subject",pt=function(){function n(t,e){if(typeof t!="string")throw new Error("Invalid subject given to resource, must be a string, found "+t);this.new=!!e,this.loading=!1,this.subject=t,this.propvals=new Map,this.appliedCommitSignatures=new Set,this.commitBuilder=new Jt(t)}return n.prototype.canWrite=function(t,e,i){return mt(this,void 0,void 0,function(){var s,r,a;return gt(this,function(c){switch(c.label){case 0:return s=this.get(L.write),e?s&&Qt(s).includes(e)?[2,[!0,void 0]]:s&&Qt(s).includes(Je.publicAgent)?[2,[!0,void 0]]:(r=this.get(L.parent),r?r===e?[2,[!0,void 0]]:i===r?(console.warn("Circular parent",i),[2,[!0,"Circular parent in ".concat(this.getSubject())]]):[4,t.getResourceAsync(r)]:[2,[!1,"No write right or parent in ".concat(this.getSubject())]]):[2,[!1,"No agent given"]];case 1:return a=c.sent(),[4,a.canWrite(t,e,this.getSubject())];case 2:return[2,c.sent()]}})})},n.prototype.clone=function(){var t=new n(this.subject);return t.propvals=this.propvals,t.destroy=this.destroy,t.loading=this.loading,t.new=this.new,t.error=this.error,t.commitError=this.commitError,t.commitBuilder=this.commitBuilder.clone(),t.appliedCommitSignatures=this.appliedCommitSignatures,t},n.prototype.isReady=function(){return!this.loading&&this.error===void 0},n.prototype.get=function(t){return this.propvals.get(t)},n.prototype.getSubjects=function(t){return this.getArray(t).map(function(e){return typeof e=="string"?e:e["@id"]})},n.prototype.getArray=function(t){var e,i=(e=this.propvals.get(t))!==null&&e!==void 0?e:[];return Qt(i)},n.prototype.getClasses=function(){return this.getSubjects(L.isA)},n.prototype.hasClasses=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.every(function(s){return t.getClasses().includes(s)})},n.prototype.getCommitBuilder=function(){return this.commitBuilder},n.prototype.getSubject=function(){return this.subject},n.prototype.getSubjectNoParams=function(){var t=new URL(this.subject);return t.origin+t.pathname},n.prototype.getPropVals=function(){return this.propvals},n.prototype.getRights=function(t){return mt(this,void 0,void 0,function(){var e,i,s,r,a,c,l=this;return gt(this,function(o){switch(o.label){case 0:return e=[],i=this.getSubjects(L.write),i.forEach(function(u){e.push({for:u,type:Ft.WRITE,setIn:l.subject})}),s=this.getSubjects(L.read),s.forEach(function(u){e.push({for:u,type:Ft.READ,setIn:l.subject})}),r=this.get(L.parent),r?r===this.getSubject()?(console.warn("Circular parent",r),[2,e]):[4,t.getResourceAsync(r)]:[3,3];case 1:return a=o.sent(),[4,a.getRights(t)];case 2:c=o.sent(),e.push.apply(e,Yt([],Kt(c),!1)),o.label=3;case 3:return[2,e]}})})},n.prototype.isUnauthorized=function(){return!!this.error&&$r(this.error)},n.prototype.destroy=function(t,e){return mt(this,void 0,void 0,function(){var i,s,r;return gt(this,function(a){switch(a.label){case 0:if(i=new Jt(this.getSubject()),i.setDestroy(!0),e===void 0&&(e=t.getAgent()),(e==null?void 0:e.subject)===void 0)throw new Error("No agent has been set or passed, you cannot delete this.");return[4,i.sign(e.privateKey,e.subject)];case 1:return s=a.sent(),r=new URL(this.getSubject()).origin+"/commit",[4,t.postCommit(s,r)];case 2:return a.sent(),t.removeResource(this.getSubject()),[2]}})})},n.prototype.pushPropVal=function(t){for(var e,i,s=[],r=1;r<arguments.length;r++)s[r-1]=arguments[r];var a=(i=this.get(t))!==null&&i!==void 0?i:[];a.push.apply(a,Yt([],Kt(s),!1)),(e=this.commitBuilder).addPushAction.apply(e,Yt([t],Kt(s),!1)),this.propvals.set(t,a)},n.prototype.removePropVal=function(t){this.propvals.delete(t),this.commitBuilder.addRemoveAction(t)},n.prototype.removePropValLocally=function(t){this.propvals.delete(t)},n.prototype.save=function(t,e){var i,s,r;return mt(this,void 0,void 0,function(){var a,c,l,o,u,f,b,m,p;return gt(this,function(v){switch(v.label){case 0:if(t.addResources(this),a=(i=t.getAgent())!==null&&i!==void 0?i:e,!a)throw new Error("No agent has been set or passed, you cannot save.");return c=(s=this.get(L.commit.lastCommit))===null||s===void 0?void 0:s.toString(),c&&this.commitBuilder.setPreviousCommit(c),l=this.commitBuilder.clone(),this.commitBuilder=new Jt(this.getSubject()),[4,l.sign(a.privateKey,a.subject)];case 1:o=v.sent(),this.appliedCommitSignatures.add(o.signature),this.loading=!1,this.new=!1,u=new URL(this.getSubject()).origin+"/commit",v.label=2;case 2:return v.trys.push([2,4,,8]),this.commitError=void 0,[4,t.postCommit(o,u)];case 3:return f=v.sent(),this.setUnsafe(L.commit.lastCommit,f.id),t.subscribeWebSocket(this.subject),t.notifyResourceSaved(this),[2,f.id];case 4:return b=v.sent(),b.message.includes("previousCommit")?(console.warn("previousCommit missing or mismatch, retrying..."),[4,t.fetchResourceFromServer(this.getSubject())]):[3,7];case 5:return m=v.sent(),p=(r=m.get(L.commit.lastCommit))===null||r===void 0?void 0:r.toString(),p&&this.setUnsafe(L.commit.lastCommit,p),[4,this.save(t,a)];case 6:return[2,v.sent()];case 7:throw this.commitBuilder=l,this.commitError=b,t.addResources(this),b;case 8:return[2]}})})},n.prototype.set=function(t,e,i,s){return s===void 0&&(s=!0),mt(this,void 0,void 0,function(){var r;return gt(this,function(a){switch(a.label){case 0:return i.isOffline()&&(console.warn("Offline, not validating"),s=!1),s?[4,i.getProperty(t)]:[3,2];case 1:r=a.sent(),Yr(e,r.datatype),a.label=2;case 2:return this.propvals.set(t,e),this.commitBuilder.addSetAction(t,e),[2]}})})},n.prototype.setUnsafe=function(t,e){this.propvals.set(t,e)},n.prototype.setError=function(t){this.error=t},n.prototype.setSubject=function(t){ot.tryValidSubject(t),this.commitBuilder.setSubject(t),this.subject=t},n}(),Ft;(function(n){n.READ="read",n.WRITE="write"})(Ft||(Ft={}));var Ae=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},Ee=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},_e=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},Re=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},Qr=function(){function n(){this.subscriptions=new Map}return n.prototype.register=function(t,e){var i,s=(i=this.subscriptions.get(t))!==null&&i!==void 0?i:new Set;return s.add(e),this.subscriptions.set(t,s),function(){s.delete(e)}},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return Ae(this,void 0,void 0,function(){var s,r,a=this;return Ee(this,function(c){switch(c.label){case 0:return this.subscriptions.has(t)?(s=this.subscriptions.get(t),r=function(l){return Ae(a,void 0,void 0,function(){return Ee(this,function(o){return l.apply(void 0,Re([],_e(e),!1)),[2]})})},s?[4,Promise.allSettled(Re([],_e(s),!1).map(function(l){return r(l)}))]:[2]):[2];case 1:return c.sent(),[2]}})})},n.prototype.hasSubscriptions=function(t){return this.subscriptions.has(t)},n}(),Ve=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},qe=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},tn=globalThis&&globalThis.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Te=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},en=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))};function Be(n,t){var e=new URL(n);e.protocol==="http:"?e.protocol="ws":e.protocol="wss",e.pathname="/ws";var i=new WebSocket(e.toString());return i.onopen=function(s){return rn(t,i)},i.onmessage=function(s){return nn(s,t)},i.onerror=sn,i}function rn(n,t){$e(t,n).then(function(){var e,i;try{for(var s=tn(n.subscribers.keys()),r=s.next();!r.done;r=s.next()){var a=r.value;n.subscribeWebSocket(a)}}catch(c){e={error:c}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}})}function nn(n,t){if(n.data.startsWith("COMMIT ")){var e=n.data.slice(7);zr(e,t)}else if(n.data.startsWith("ERROR "))t.notifyError(n.data.slice(6));else if(n.data.startsWith("RESOURCE ")){var i=n.data.slice(9),s=JSON.parse(i),r=new At,a=Te(r.parseObject(s),2);a[0];var c=a[1];t.addResources.apply(t,en([],Te(c),!1))}else console.warn("Unknown websocket message:",n)}function sn(n){console.error("websocket error:",n)}function $e(n,t){var e;return Ve(this,void 0,void 0,function(){var i,s;return qe(this,function(r){switch(r.label){case 0:return i=t.getAgent(),i?!n.url.startsWith("ws://localhost:")&&(!((e=i==null?void 0:i.subject)===null||e===void 0)&&e.startsWith("http://localhost"))?(console.warn("Can't authenticate localhost Agent over websocket"),[2]):[4,Ne(n.url,i)]:[2];case 1:return s=r.sent(),n.send("AUTHENTICATE "+JSON.stringify(s)),[2]}})})}function on(n,t){return Ve(this,void 0,void 0,function(){return qe(this,function(e){return n.send("GET "+t),[2]})})}var W=globalThis&&globalThis.__awaiter||function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(i.next(u))}catch(f){a(f)}}function l(u){try{o(i.throw(u))}catch(f){a(f)}}function o(u){u.done?r(u.value):s(u.value).then(c,l)}o((i=i.apply(n,t||[])).next())})},G=globalThis&&globalThis.__generator||function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(n,e)}catch(u){o=[6,u],s=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},an=globalThis&&globalThis.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ue=globalThis&&globalThis.__read||function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],a;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return r},Oe=globalThis&&globalThis.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},et;(function(n){n.ResourceSaved="resource-saved",n.ResourceRemoved="resource-removed",n.ResourceManuallyCreated="resource-manually-created",n.AgentChanged="agent-changed",n.Error="error"})(et||(et={}));var Xt=function(){return typeof WebSocket<"u"},bn=function(){function n(t){t===void 0&&(t={}),this.eventManager=new Qr,this._resources=new Map,this.webSockets=new Map,this.subscribers=new Map,t.serverUrl&&this.setServerUrl(t.serverUrl),t.agent&&this.setAgent(t.agent),this.client=new ot(this.injectedFetch),this.getAgent=this.getAgent.bind(this),this.setAgent=this.setAgent.bind(this)}return Object.defineProperty(n.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),n.prototype.injectFetch=function(t){this.injectedFetch=t,this.client.setFetch(t)},n.prototype.addResources=function(){for(var t,e,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];try{for(var r=an(i),a=r.next();!a.done;a=r.next()){var c=a.value;this.addResource(c)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},n.prototype.addResource=function(t){if(t.get(S.properties.incomplete)){var e=this.resources.get(t.getSubject());if(e&&!e.loading)return}this.resources.set(t.getSubject(),t),this.notify(t.clone())},n.prototype.checkSubjectTaken=function(t){return W(this,void 0,void 0,function(){var e;return G(this,function(i){switch(i.label){case 0:return[4,this.getResourceAsync(t)];case 1:return e=i.sent(),e.isReady()?[2,!0]:[2,!1]}})})},n.prototype.buildUniqueSubjectFromParts=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return W(this,void 0,void 0,function(){var i;return G(this,function(s){return i=t.join("/"),[2,this.findAvailableSubject(i)]})})},n.prototype.createSubject=function(t){var e=this.randomPart();return t=t||"things","".concat(this.getServerUrl(),"/").concat(t,"/").concat(e)},n.prototype.fetchResourceFromServer=function(t,e){return e===void 0&&(e={}),W(this,void 0,void 0,function(){var i,s,r,a;return G(this,function(c){switch(c.label){case 0:return e.setLoading&&(i=new pt(t),i.loading=!0,this.addResources(i)),s=this.getWebSocketForSubject(t),!e.noWebSocket&&Xt()&&(s==null?void 0:s.readyState)===WebSocket.OPEN?(on(s,t),[3,3]):[3,1];case 1:return r=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,[4,this.client.fetchResourceHTTP(t,{from:e.fromProxy?this.getServerUrl():void 0,signInfo:r})];case 2:a=c.sent().createdResources,this.addResources.apply(this,Oe([],Ue(a),!1)),c.label=3;case 3:return[2,this.resources.get(t)]}})})},n.prototype.getAllSubjects=function(){return Array.from(this.resources.keys())},n.prototype.getDefaultWebSocket=function(){return this.webSockets.get(this.getServerUrl())},n.prototype.getWebSocketForSubject=function(t){var e=new URL(t),i=this.webSockets.get(e.origin);if(i)return i;typeof window<"u"&&this.webSockets.set(e.origin,Be(e.origin,this))},n.prototype.getServerUrl=function(){return this.serverUrl},n.prototype.getAgent=function(){var t;return(t=this.agent)!==null&&t!==void 0?t:void 0},n.prototype.getResourceLoading=function(t,e){if(t===void 0&&(t=it),e===void 0&&(e={}),t===it||t===null){var i=new pt(it,e.newResource);return i}var s=this.resources.get(t);if(s)!e.allowIncomplete&&s.loading===!1&&s.get(S.properties.incomplete)&&(s.loading=!0,this.addResources(s),this.fetchResourceFromServer(t,e));else{var i=new pt(t,e.newResource);return i.loading=!0,this.addResources(i),e.newResource||this.fetchResourceFromServer(t,e),i}return s},n.prototype.getResourceAsync=function(t){return W(this,void 0,void 0,function(){var e;return G(this,function(i){return e=this.resources.get(t),e?[2,e]:[2,this.fetchResourceFromServer(t)]})})},n.prototype.getProperty=function(t){var e;return W(this,void 0,void 0,function(){var i,s,r,a,c,l;return G(this,function(o){switch(o.label){case 0:return[4,this.getResourceAsync(t)];case 1:if(i=o.sent(),i===void 0)throw Error("Property ".concat(t," is not found"));if(i.error)throw Error("Property ".concat(t," cannot be loaded: ").concat(i.error));if(s=new cn,r=i.get(S.properties.datatype),r===void 0)throw Error("Property ".concat(t," has no datatype: ").concat(i.getPropVals()));if(a=i.get(S.properties.shortname),a===void 0)throw Error("Property ".concat(t," has no shortname: ").concat(i.getPropVals()));if(c=i.get(S.properties.description),c===void 0)throw Error("Property ".concat(t," has no description: ").concat(i.getPropVals()));return l=(e=i.get(S.properties.classType))===null||e===void 0?void 0:e.toString(),s.classType=l,s.shortname=a.toString(),s.description=c.toString(),s.datatype=Jr(r.toString()),[2,s]}})})},n.prototype.notifyError=function(t){var e=t instanceof Error?t:new Error(t);if(this.eventManager.hasSubscriptions(et.Error))this.eventManager.emit(et.Error,e);else throw e},n.prototype.isOffline=function(){var t;return typeof window>"u"?!1:!(!((t=window==null?void 0:window.navigator)===null||t===void 0)&&t.onLine)},n.prototype.notify=function(t){return W(this,void 0,void 0,function(){var e,i,s=this;return G(this,function(r){return e=t.getSubject(),i=this.subscribers.get(e),i===void 0?[2]:(Promise.allSettled(i.map(function(a){return W(s,void 0,void 0,function(){return G(this,function(c){return[2,a(t)]})})})),[2])})})},n.prototype.notifyResourceSaved=function(t){this.eventManager.emit(et.ResourceSaved,t)},n.prototype.notifyResourceManuallyCreated=function(t){this.eventManager.emit(et.ResourceManuallyCreated,t)},n.prototype.removeResource=function(t){var e=this.resources.get(t);this.resources.delete(t),e&&this.eventManager.emit(et.ResourceRemoved,e)},n.prototype.renameSubject=function(t,e){return W(this,void 0,void 0,function(){var i;return G(this,function(s){switch(s.label){case 0:if(ot.tryValidSubject(e),i=this.resources.get(t),i===void 0)throw Error("Old subject does not exist in store: ".concat(t));return[4,this.checkSubjectTaken(e)];case 1:if(s.sent())throw Error("New subject name is already taken: ".concat(e));return i.setSubject(e),this.resources.set(e,i),this.removeResource(t),[2]}})})},n.prototype.setAgent=function(t){var e=this;this.agent=t,t&&(je(this.serverUrl,t),this.webSockets.forEach(function(i){$e(i,e)}),this.resources.forEach(function(i){i.isUnauthorized()&&e.fetchResourceFromServer(i.getSubject())})),this.eventManager.emit(et.AgentChanged,t)},n.prototype.setServerUrl=function(t){if(ot.tryValidSubject(t),t.substring(-1)==="/")throw Error("baseUrl should not have a trailing slash");this.serverUrl=t,Xt()&&this.openWebSocket(t)},n.prototype.openWebSocket=function(t){if(Xt()){if(this.webSockets.has(t))return;this.webSockets.set(t,Be(t,this))}else console.warn("WebSockets not supported, no window available")},n.prototype.subscribe=function(t,e){if(t===void 0)throw Error("Cannot subscribe to undefined subject");var i=this.subscribers.get(t);i===void 0&&(this.subscribeWebSocket(t),i=[]),i.push(e),this.subscribers.set(t,i)},n.prototype.subscribeWebSocket=function(t){if(t!==it)try{var e=this.getWebSocketForSubject(t);(e==null?void 0:e.readyState)===1&&(e==null||e.send("SUBSCRIBE ".concat(t)))}catch(i){console.error(i)}},n.prototype.unSubscribeWebSocket=function(t){var e;if(t!==it)try{(e=this.getDefaultWebSocket())===null||e===void 0||e.send("UNSUBSCRIBE ".concat(t))}catch(i){console.error(i)}},n.prototype.unsubscribe=function(t,e){if(t!==void 0){var i=this.subscribers.get(t);i&&(i=i==null?void 0:i.filter(function(s){return s!==e}),this.subscribers.set(t,i))}},n.prototype.on=function(t,e){return this.eventManager.register(t,e)},n.prototype.uploadFiles=function(t,e){return W(this,void 0,void 0,function(){var i,s;return G(this,function(r){switch(r.label){case 0:if(i=this.getAgent(),!i)throw Error("No agent set, cannot upload files");return[4,this.client.uploadFiles(t,this.getServerUrl(),i,e)];case 1:return s=r.sent(),this.addResources.apply(this,Oe([],Ue(s),!1)),[2,s.map(function(a){return a.getSubject()})]}})})},n.prototype.postCommit=function(t,e){return W(this,void 0,void 0,function(){return G(this,function(i){return[2,this.client.postCommit(t,e)]})})},n.prototype.randomPart=function(){return Math.random().toString(36).substring(2)},n.prototype.findAvailableSubject=function(t,e){return e===void 0&&(e=!0),W(this,void 0,void 0,function(){var i,s,r;return G(this,function(a){switch(a.label){case 0:return i="".concat(this.getServerUrl(),"/").concat(t),e||(s=this.randomPart(),i+="-".concat(s)),[4,this.checkSubjectTaken(i)];case 1:return r=a.sent(),r?[2,this.findAvailableSubject(t,!1)]:[2,i]}})})},n}(),cn=function(){function n(){}return n}();globalThis&&globalThis.__read;function Qt(n){if(n===void 0)throw new Error("Not an array: ".concat(n,", is ").concat(typeof n));if(n.constructor===Array)return n;throw new Error("Not an array: ".concat(n,", is a ").concat(typeof n))}var un={getAll:"https://atomicdata.dev/classes/?page_size=999",agent:"https://atomicdata.dev/classes/Agent",chatRoom:"https://atomicdata.dev/classes/ChatRoom",collection:"https://atomicdata.dev/classes/Collection",commit:"https://atomicdata.dev/classes/Commit",class:"https://atomicdata.dev/classes/Class",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",elements:{paragraph:"https://atomicdata.dev/classes/elements/Paragraph"},error:"https://atomicdata.dev/classes/Error",property:"https://atomicdata.dev/classes/Property",datatype:"https://atomicdata.dev/classes/Datatype",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",invite:"https://atomicdata.dev/classes/Invite",file:"https://atomicdata.dev/classes/File",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",displayStyle:"https://atomicdata.dev/class/DisplayStyle",displayStyles:{grid:"https://atomicdata.dev/display-style/grid",list:"https://atomicdata.dev/display-style/list"}},L={getAll:"https://atomicdata.dev/properties/?page_size=999",children:"https://atomicdata.dev/properties/children",classType:"https://atomicdata.dev/properties/classtype",createdBy:"https://atomicdata.dev/properties/createdBy",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",drives:"https://atomicdata.dev/properties/drives",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",paymentPointer:"https://atomicdata.dev/properties/paymentPointer",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",subResources:"https://atomicdata.dev/properties/subresources",write:"https://atomicdata.dev/properties/write",displayStyle:"https://atomicdata.dev/property/display-style",agent:{publicKey:"https://atomicdata.dev/properties/publicKey"},collection:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value"},commit:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"},document:{elements:"https://atomicdata.dev/properties/documents/elements"},endpoint:{parameters:"https://atomicdata.dev/properties/endpoint/parameters",results:"https://atomicdata.dev/properties/endpoint/results"},search:{query:"https://atomicdata.dev/properties/search/query",limit:"https://atomicdata.dev/properties/search/limit",property:"https://atomicdata.dev/properties/search/property"},redirect:{destination:"https://atomicdata.dev/properties/destination",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent"},invite:{agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write"},file:{filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments"},chatRoom:{messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo"},bookmark:{url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl"}},ln={atomicUrl:"https://atomicdata.dev/datatypes/atomicURL",boolean:"https://atomicdata.dev/datatypes/boolean",date:"https://atomicdata.dev/datatypes/date",float:"https://atomicdata.dev/datatypes/float",integer:"https://atomicdata.dev/datatypes/integer",markdown:"https://atomicdata.dev/datatypes/markdown",resourceArray:"https://atomicdata.dev/datatypes/resourceArray",slug:"https://atomicdata.dev/datatypes/slug",string:"https://atomicdata.dev/datatypes/string",timestamp:"https://atomicdata.dev/datatypes/timestamp"},Je={publicAgent:"https://atomicdata.dev/agents/publicAgent"},S={properties:L,classes:un,datatypes:ln,instances:Je};export{hn as A,pn as P,bn as S,fn as d,yn as q,S as u,ie as y,dn as z};
